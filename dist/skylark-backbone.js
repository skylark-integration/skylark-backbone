/**
 * skylark-backbone - A version of backbone that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
!function(t,e){var n=e.define,require=e.require,i="function"==typeof n&&n.amd,r=!i&&"undefined"!=typeof exports;if(!i&&!n){var s={};n=e.define=function(t,e,n){"function"==typeof n?(s[t]={factory:n,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var n=e.split("/"),i=t.split("/");n.pop();for(var r=0;r<i.length;r++)"."!=i[r]&&(".."==i[r]?n.pop():n.push(i[r]));return n.join("/")}(e,t)}),resolved:!1,exports:null},require(t)):s[t]={factory:null,resolved:!0,exports:n}},require=e.require=function(t){if(!s.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var module=s[t];if(!module.resolved){var n=[];module.deps.forEach(function(t){n.push(require(t))}),module.exports=module.factory.apply(e,n)||null,module.resolved=!0}return module.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,require){t("skylark-backbone/backbone",["skylark-langx/skylark","skylark-data-entities","skylark-jquery"],function(t,e,n){var i={emulateHTTP:!1,emulateJSON:!1};return i.$=n,i.sync=function(t,n,r){return langx.defaults(r||(r={}),{emulateHTTP:i.emulateHTTP,emulateJSON:i.emulateJSON}),e.backends.ajaxSync.apply(this,[t,n,r])},t.attach("itg.backbone",i)}),t("skylark-backbone/events",["skylark-langx/langx","./backbone"],function(t,e){var n=Array.prototype.slice,i={on:function(t,e,i){var r=function(){var i=n.call(arguments,1);"all"==t&&i.unshift(arguments[0].type),e.apply(this,i)};return r._=e,this.overrided(t,r,i)},once:function(t,e,n){return this.one(t,e,n)},bind:function(t,e,n){return this.on(t,e,n)},unbind:function(t,e,n){return this.off(t,e,n)},stopListening:function(t,e,n){return this.unlistenTo(t,e,n)}},r=t.Evented.inherit(i),s=r.prototype,o=e.Events={bind:s.bind,listenTo:s.listenTo,listenToOnce:s.listenToOnce,off:s.off,on:s.on,once:s.once,stopListening:s.stopListening,trigger:s.trigger,unbind:s.unbind,unlistenTo:s.unlistenTo};return t.extend(e,o),{EventExtends:i,BackboneEvented:r}}),t("skylark-backbone/helper",["skylark-langx/langx","skylark-underscore/underscore","./backbone"],function(t,e,n){var i=function(t,n){return e.isFunction(t)?t:e.isObject(t)&&!n._isModel(t)?r(t):e.isString(t)?function(e){return e.get(t)}:t},r=function(t){var n=e.matches(t);return function(t){return n(t.attributes)}},s=n.extend=function(t,n){t.constructor=this._constructor;var i=this.inherit(t);return e.extend(i,n),i};return{addUnderscoreMethods:function(t,n,r){e.each(n,function(n,s){e[s]&&(t.prototype[s]=function(t,n,r){switch(t){case 1:return function(){return e[n](this[r])};case 2:return function(t){return e[n](this[r],t)};case 3:return function(t,s){return e[n](this[r],i(t,this),s)};case 4:return function(t,s,o){return e[n](this[r],i(t,this),s,o)};default:return function(){var t=slice.call(arguments);return t.unshift(this[r]),e[n].apply(e,t)}}}(n,s,r))})},extend:s}}),t("skylark-backbone/Collection",["skylark-langx/langx","skylark-data-entities","./backbone","./events","./helper"],function(t,e,n,i,r){var s=n.Collection=e.Collection.inherit({_construct:function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,_.extend({silent:!0},e))},initialize:function(){},sync:function(){return n.sync.apply(this,arguments)}});s.partial(i.EventExtends),Object.defineProperty(s.prototype,"model",{get(){return this.entity},set(t){this.entity=t}}),Object.defineProperty(s.prototype,"models",{get(){return this.entities},set(t){this.entities=t}}),s.prototype.modelId=s.prototype.entityId,s.prototype._isModel=s.prototype._isEntity;return r.addUnderscoreMethods(s,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models"),s.extend=r.extend,s}),t("skylark-backbone/Model",["skylark-langx/langx","skylark-underscore/underscore","skylark-data-entities","./backbone","./events","./helper"],function(t,e,n,i,r,s){var o=i.Model=n.Entity.inherit({_construct:function(e,n){t.Stateful.prototype._construct.apply(this,arguments),this.initialize.apply(this,arguments)},initialize:function(){},escape:function(t){return e.escape(this.get(t))},matches:function(t){return!!e.iteratee(t,this)(this.attributes)},sync:function(){return i.sync.apply(this,arguments)}});return o.partial(r.EventExtends),o.extend=s.extend,o}),t("skylark-backbone/History",["skylark-langx/langx","skylark-underscore/underscore","./backbone","./events","./helper"],function(t,e,n,i,r){var s=n.History=i.BackboneEvented.inherit({_construct:function(){this.handlers=[],this.checkUrl=e.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)}}),o=/^[#\/]|\s+$/g,a=/^\/+|\/+$/g,c=/#.*$/;return s.started=!1,s.partial({interval:50,atRoot:function(){var t=this.location.pathname.replace(/[^\/]$/,"$&/");return t===this.root&&!this.getSearch()},matchRoot:function(){var t=this.decodeFragment(this.location.pathname),e=t.slice(0,this.root.length-1)+"/";return e===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(o,"")},start:function(t){if(s.started)throw new Error("Backbone.history has already been started");if(s.started=!0,this.options=e.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(a,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var n=this.root.slice(0,-1)||"/";return this.location.replace(n+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var i=document.body,r=i.insertBefore(this.iframe,i.firstChild).contentWindow;r.document.open(),r.document.close(),r.location.hash="#"+this.fragment}var o=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?o("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?o("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),s.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(t){return!!this.matchRoot()&&(t=this.fragment=this.getFragment(t),e.some(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0}))},navigate:function(t,e){if(!s.started)return!1;e&&!0!==e||(e={trigger:!!e}),t=this.getFragment(t||"");var n=this.root;""!==t&&"?"!==t.charAt(0)||(n=n.slice(0,-1)||"/");var i=n+t;if(t=this.decodeFragment(t.replace(c,"")),this.fragment!==t){if(this.fragment=t,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;e.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,n){if(n){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash="#"+e}}),n.history=new s,s.extend=n.extend,s}),t("skylark-backbone/Router",["skylark-langx/langx","skylark-underscore/underscore","./backbone","./events","./helper"],function(t,e,n,i,r){var s=n.Router=i.BackboneEvented.inherit({_construct:function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)}}),o=/\((.*?)\)/g,a=/(\(\?)?:\w+/g,c=/\*\w+/g,u=/[\-{}\[\]+?.,\\\^$|#\s]/g;return s.partial({initialize:function(){},route:function(t,i,r){e.isRegExp(t)||(t=this._routeToRegExp(t)),e.isFunction(i)&&(r=i,i=""),r||(r=this[i]);var s=this;return n.history.route(t,function(e){var o=s._extractParameters(t,e);!1!==s.execute(r,o,i)&&(s.trigger.apply(s,["route:"+i].concat(o)),s.trigger("route",i,o),n.history.trigger("route",s,i,o))}),this},execute:function(t,e,n){t&&t.apply(this,e)},navigate:function(t,e){return n.history.navigate(t,e),this},_bindRoutes:function(){if(this.routes){this.routes=e.result(this,"routes");for(var t,n=e.keys(this.routes);null!=(t=n.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(u,"\\$&").replace(o,"(?:$1)?").replace(a,function(t,e){return e?t:"([^/?]+)"}).replace(c,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,n){var i=t.exec(n).slice(1);return e.map(i,function(t,e){return e===i.length-1?t||null:t?decodeURIComponent(t):null})}}),s.extend=r.extend,s}),t("skylark-backbone/View",["skylark-langx/langx","skylark-jquery","skylark-domx-noder","skylark-domx-plugins","skylark-underscore/underscore","./backbone","./events","./helper"],function(t,e,n,i,r,s,o,a){var c=s.View=i.Plugin.inherit({_construct:function(t){this.cid=r.uniqueId("view"),this.preinitialize.apply(this,arguments),r.extend(this,r.pick(t,h)),this._ensureElement(),this.initialize.apply(this,arguments)},tagName:"div",$:function(t){return this.$el.find(t)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.unlistenTo(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=e(t),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=t.result(this,"events")),!e)return this;for(var n in this.undelegateEvents(),e){var i=e[n];if(t.isFunction(i)||(i=this[i]),i){var r=n.match(u);this.delegate(r[1],r[2],t.proxy(i,this))}}return this},delegate:function(t,e,n){return this.$el.on(t+".delegateEvents"+this.uid,e,n),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.uid),this},undelegate:function(t,e,n){return this.$el.off(t+".delegateEvents"+this.uid,e,n),this},_createElement:function(t,e){return n.createElement(t,e)},_ensureElement:function(){if(this.el)this.setElement(t.result(this,"el"));else{var e=t.mixin({},t.result(this,"attributes"));this.id&&(e.id=t.result(this,"id")),this.className&&(e.class=t.result(this,"className")),this.setElement(this._createElement(t.result(this,"tagName"),e)),this._setAttributes(e)}},_setAttributes:function(t){this.$el.attr(t)}});c.partial(o.EventExtends);var u=/^(\S+)\s*(.*)$/,h=["model","collection","el","id","attributes","className","tagName","events"];return c.extend=a.extend,c}),t("skylark-backbone/UndoManager",["skylark-langx/langx","skylark-underscore/underscore","./backbone","./Model","./Collection"],function(t,e,n,i,r){var s=Array.prototype.slice;function o(t,e,n){return n.length<=4?t.call(e,n[0],n[1],n[2],n[3]):t.apply(e,n)}function a(t,e){return s.call(t,e)}function c(t,n){return null!=t&&(e.isArray(n)||(n=a(arguments,1)),e.all(n,function(e){return e in t}))}var u=function(){var t=!1,n=-1;return function(){return t||(n++,t=!0,e.defer(function(){t=!1})),n}}();function h(){this.registeredObjects=[],this.cidIndexes=[]}function l(t,n,i,r){for(var s,o=0,a=n.length;o<a;o++)if(s=n[o]){if("on"===t){if(!r.objectRegistry.register(s))continue}else if(!r.objectRegistry.unregister(s))continue;e.isFunction(s[t])&&s[t]("all",i,r)}}function d(t,n){var i=n.type,r=n.undoTypes,s=!r[i]||r[i][t];e.isFunction(s)&&s(n.object,n.before,n.after,n.options)}function f(t,n,i,r,o){if(!(i.isCurrentlyUndoRedoing||"undo"===t&&-1===i.pointer||"redo"===t&&i.pointer===i.length-1)){i.isCurrentlyUndoRedoing=!0;var a,c,u="undo"===t;for(o?c=u&&i.pointer===i.length-1||!u&&-1===i.pointer?e.clone(i.models):s.apply(i.models,u?[0,i.pointer]:[i.pointer,i.length-1]):(a=i.at(u?i.pointer:i.pointer+1),c=r?i.where({magicFusionIndex:a.get("magicFusionIndex")}):[a]),i.pointer+=(u?-1:1)*c.length;a=u?c.pop():c.shift();)a[t]();i.isCurrentlyUndoRedoing=!1,n.trigger(t,n)}}function p(t,e,n,i){if(t.track&&!t.isCurrentlyUndoRedoing&&e in i&&function(t,e){var n=t.condition,i=typeof n;return"function"===i?!!o(n,t,e):"boolean"!==i||n}(i[e],n)){var r=o(i[e].on,i[e],n);if(c(r,"object","before","after")){if(r.type=e,r.magicFusionIndex=u(),r.undoTypes=i,t.pointer<t.length-1)for(var s=t.length-t.pointer-1;s--;)t.pop();t.pointer=t.length,t.add(r),t.length>t.maximumStackLength&&(t.shift(),t.pointer--)}}}h.prototype={isRegistered:function(t){return t&&t.cid?this.registeredObjects[t.cid]:e.contains(this.registeredObjects,t)},register:function(t){return!this.isRegistered(t)&&(t&&t.cid?(this.registeredObjects[t.cid]=t,this.cidIndexes.push(t.cid)):this.registeredObjects.push(t),!0)},unregister:function(t){if(this.isRegistered(t)){if(t&&t.cid)delete this.registeredObjects[t.cid],this.cidIndexes.splice(e.indexOf(this.cidIndexes,t.cid),1);else{var n=e.indexOf(this.registeredObjects,t);this.registeredObjects.splice(n,1)}return!0}return!1},get:function(){return e.map(this.cidIndexes,function(t){return this.registeredObjects[t]},this).concat(this.registeredObjects)}};var g={add:{undo:function(t,e,n,i){t.remove(n,i)},redo:function(t,e,n,i){i.index&&(i.at=i.index),t.add(n,i)},on:function(t,n,i){return{object:n,before:void 0,after:t,options:e.clone(i)}}},remove:{undo:function(t,e,n,i){"index"in i&&(i.at=i.index),t.add(e,i)},redo:function(t,e,n,i){t.remove(e,i)},on:function(t,n,i){return{object:n,before:t,after:void 0,options:e.clone(i)}}},change:{undo:function(t,n,i,r){e.isEmpty(n)?e.each(e.keys(i),t.unset,t):(t.set(n),r&&r.unsetData&&r.unsetData.before&&r.unsetData.before.length&&e.each(r.unsetData.before,t.unset,t))},redo:function(t,n,i,r){e.isEmpty(i)?e.each(e.keys(n),t.unset,t):(t.set(i),r&&r.unsetData&&r.unsetData.after&&r.unsetData.after.length&&e.each(r.unsetData.after,t.unset,t))},on:function(t,n){var i=t.changedAttributes(),r=e.keys(i),s=e.pick(t.previousAttributes(),r),o=e.keys(s),a=(n||(n={})).unsetData={after:[],before:[]};return r.length!=o.length&&(r.length>o.length?e.each(r,function(t){t in s||a.before.push(t)},this):e.each(o,function(t){t in i||a.after.push(t)})),{object:t,before:s,after:i,options:e.clone(n)}}},reset:{undo:function(t,e,n){t.reset(e)},redo:function(t,e,n){t.reset(n)},on:function(t,n){return{object:t,before:n.previousModels,after:e.clone(t.models)}}}};function k(){}function y(t,n,i,r){if("object"==typeof n)return e.each(n,function(e,n){2===t?y(t,e,i,r):y(t,n,e,i)});switch(t){case 0:c(i,"undo","redo","on")&&e.all(e.pick(i,"undo","redo","on"),e.isFunction)&&(r[n]=i);break;case 1:r[n]&&e.isObject(i)&&(r[n]=e.extend({},r[n],i));break;case 2:delete r[n]}return this}k.prototype=g;var m=i.extend({defaults:{type:null,object:null,before:null,after:null,magicFusionIndex:null},undo:function(t){d("undo",this.attributes)},redo:function(t){d("redo",this.attributes)}}),v=r.extend({model:m,pointer:-1,track:!1,isCurrentlyUndoRedoing:!1,maximumStackLength:1/0,setMaxLength:function(t){this.maximumStackLength=t}}),b=i.extend({defaults:{maximumStackLength:1/0,track:!1},initialize:function(t){this.stack=new v,this.objectRegistry=new h,this.undoTypes=new k,this.stack.setMaxLength(this.get("maximumStackLength")),this.on("change:maximumStackLength",function(t,e){this.stack.setMaxLength(e)},this),t&&t.track&&this.startTracking(),t&&t.register&&(e.isArray(t.register)||e.isArguments(t.register)?o(this.register,this,t.register):this.register(t.register))},startTracking:function(){this.set("track",!0),this.stack.track=!0},stopTracking:function(){this.set("track",!1),this.stack.track=!1},isTracking:function(){return this.get("track")},_addToStack:function(t){p(this.stack,t,a(arguments,1),this.undoTypes)},register:function(){l("on",arguments,this._addToStack,this)},unregister:function(){l("off",arguments,this._addToStack,this)},unregisterAll:function(){o(this.unregister,this,this.objectRegistry.get())},undo:function(t){f("undo",this,this.stack,t)},undoAll:function(){f("undo",this,this.stack,!1,!0)},redo:function(t){f("redo",this,this.stack,t)},redoAll:function(){f("redo",this,this.stack,!1,!0)},isAvailable:function(t){var e=this.stack,n=e.length;switch(t){case"undo":return n>0&&e.pointer>-1;case"redo":return n>0&&e.pointer<n-1;default:return!1}},merge:function(t){for(var n,i=e.isArray(t)?t:a(arguments);n=i.pop();)n instanceof b&&n.stack instanceof v&&(n.stack=this.stack)},addUndoType:function(t,e){y(0,t,e,this.undoTypes)},changeUndoType:function(t,e){y(1,t,e,this.undoTypes)},removeUndoType:function(t){y(2,t,void 0,this.undoTypes)},clear:function(){this.stack.reset(),this.stack.pointer=-1}});return e.extend(b,{defaults:function(t){e.extend(b.prototype.defaults,t)},addUndoType:function(t,e){y(0,t,e,g)},changeUndoType:function(t,e){y(1,t,e,g)},removeUndoType:function(t){y(2,t,void 0,g)}}),n.UndoManager=b}),t("skylark-backbone/main",["./backbone","./events","./Collection","./Model","./History","./Router","./View","./UndoManager"],function(t){return t}),t("skylark-backbone",["skylark-backbone/main"],function(t){return t})}(n),!i){var o=require("skylark-langx/skylark");r?module.exports=o:e.skylarkjs=o}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-backbone.js.map
