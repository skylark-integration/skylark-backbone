/**
 * skylark-backbone - A version of backbone that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define(["skylark-langx/langx","skylark-underscore","./models","./backbone"],function(t,e,r,n){function o(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var i=t.klass({_construct:function(t){this.name=t;var e=this.localStorage().getItem(this.name);this.records=e&&e.split(",")||[]},save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(t){return t.id||(t.id=o()+o()+"-"+o()+"-"+o()+"-"+o()+"-"+o()+o()+o(),t.set(t.idAttribute,t.id)),this.localStorage().setItem(this.name+"-"+t.id,JSON.stringify(t)),this.records.push(t.id.toString()),this.save(),this.find(t)},update:function(t){return this.localStorage().setItem(this.name+"-"+t.id,JSON.stringify(t)),e.include(this.records,t.id.toString())||this.records.push(t.id.toString()),this.save(),this.find(t)},find:function(t){return this.jsonData(this.localStorage().getItem(this.name+"-"+t.id))},findAll:function(){return e(this.records).chain().map(function(t){return this.jsonData(this.localStorage().getItem(this.name+"-"+t))},this).compact().value()},destroy:function(t){return!t.isNew()&&(this.localStorage().removeItem(this.name+"-"+t.id),this.records=e.reject(this.records,function(e){return e===t.id.toString()}),this.save(),t)},localStorage:function(){return localStorage},jsonData:function(t){return t&&JSON.parse(t)}});return i.sync=r.localSync=function(t,e,r){var n,o,i=e.localStorage||e.collection.localStorage,s=$.Deferred&&$.Deferred();try{switch(t){case"read":n=void 0!=e.id?i.find(e):i.findAll();break;case"create":n=i.create(e);break;case"update":n=i.update(e);break;case"delete":n=i.destroy(e)}}catch(t){o=t.code===DOMException.QUOTA_EXCEEDED_ERR&&0===window.localStorage.length?"Private browsing is unsupported":t.message}return n?(e.trigger("sync",e,n,r),r&&r.success&&r.success(n),s&&s.resolve(n)):(o=o||"Record Not Found",r&&r.error&&r.error(o),s&&s.reject(o)),r&&r.complete&&r.complete(n),s&&s.promise()},r.ajaxSync=r.sync,r.getSyncMethod=function(t){return t.localStorage||t.collection&&t.collection.localStorage?r.localSync:r.ajaxSync},r.sync=function(t,e,n){return r.getSyncMethod(e).apply(this,[t,e,n])},n.LocalStorage=i});
//# sourceMappingURL=sourcemaps/LocalStorage.js.map
